CREATE TABLE task (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name VARCHAR(255) NOT NULL,
    date_time_start TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    date_time_end TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    read_only BOOLEAN DEFAULT FALSE NOT NULL,
    created_date_time TIMESTAMP WITHOUT TIME ZONE,
    update_date_time TIMESTAMP WITHOUT TIME ZONE,
    CONSTRAINT pk_task PRIMARY KEY (id)
);
ALTER TABLE task ADD CONSTRAINT uc_task_name UNIQUE (name);

CREATE TABLE task_contract_revisions (
    task_id BIGINT NOT NULL,
    revision_id BIGINT NOT NULL,
    CONSTRAINT pk_task_contract_revisions PRIMARY KEY (task_id, revision_id)
);
ALTER TABLE task_contract_revisions ADD CONSTRAINT fk_task_contract_rev_on_task FOREIGN KEY (task_id) REFERENCES task (id);
ALTER TABLE task_contract_revisions ADD CONSTRAINT fk_task_contract_rev_on_contract_revision FOREIGN KEY (revision_id) REFERENCES contract_revision (id);

CREATE TABLE task_demand_revisions (
    task_id BIGINT NOT NULL,
    revision_id BIGINT NOT NULL,
    CONSTRAINT pk_task_demand_revisions PRIMARY KEY (task_id, revision_id)
);
ALTER TABLE task_demand_revisions ADD CONSTRAINT fk_task_demand_rev_on_task FOREIGN KEY (task_id) REFERENCES task (id);
ALTER TABLE task_demand_revisions ADD CONSTRAINT fk_task_demand_rev_on_demand_revision FOREIGN KEY (revision_id) REFERENCES demand_revision (id);

CREATE TABLE task_tariff_revisions (
    task_id BIGINT NOT NULL,
    revision_id BIGINT NOT NULL,
    CONSTRAINT pk_task_tariff_revisions PRIMARY KEY (task_id, revision_id)
);
ALTER TABLE task_tariff_revisions ADD CONSTRAINT fk_task_tariff_rev_on_task FOREIGN KEY (task_id) REFERENCES task (id);
ALTER TABLE task_tariff_revisions ADD CONSTRAINT fk_task_tariff_rev_on_tariff_revision FOREIGN KEY (revision_id) REFERENCES tariff_revision (id);
